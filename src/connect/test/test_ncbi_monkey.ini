[CHAOS_MONKEY]
; Numeration starts from 1
config = CHAOS_MONKEY
enabled = 1

[CHAOS_MONKEY_PLAN1]
; regexp or wildcard?
host_match=(MSDEV101|NCBIPC8167)+.*
port_match=8080-8100
probability = 95%
write1= n_written=50;runs=100%,  repeat
write2=  text = 'garbage' ; text_length= 500; fill = last_letter ; runs= 0%,50%,25%, 100%,32 %,  ...
poll=delay=2000;ignore=yes;runs=1
connect=allow=no;runs=1,2,3,4,100

[CHAOS_MONKEY_PLAN2]
probability = 5%
; Rule for toggling
host_match=.*\.nih\.gov
port_match=8080-8089
read=runs=50%;return_status=eIO_Closed;
connect=allow=no;runs=1,2,3,4,100
poll=delay=2000;ignore=yes;runs=1


[NODEFAULTCONFIGFUNCCONFIG__DOESINTERCEPT]
enabled = 1


[NODEFAULTCONFIGFUNCCONFIG__DOESINTERCEPT_PLAN1]
probability = 95%
write= runs=1;return_status=eIO_Closed;
read= runs=1;return_status=eIO_Closed;
poll=delay=2000;ignore=yes;runs=1
connect=allow=no;runs=1


[DEFAULTCONFIG__DOESINTERCEPT]
; Numeration starts from 1
enabled = 1

[DEFAULTCONFIG__DOESINTERCEPT_PLAN1]
probability = 95%
write= runs=1;return_status=eIO_Closed;
read= runs=1;return_status=eIO_Closed;
poll=delay=2000;ignore=yes;runs=1
connect=allow=no;runs=1


[doesnotexist_PLAN1]
host_match=lbos.*
port_match=8080
write1=return_status=eIO_Unknown;runs=100%
read1=return_status=eIO_Timeout;runs=100%
poll=ignore=yes;
connect1=return_status=eIO_Unknown;runs=100%

; Semicolon test - test rules that have and do not have trailing semicolon
; Order of check for recv/send:
; 1 - no interception
; 2 - write is intercepted with 'MONKEY_READS_TEXT2', read is not intercepted
; 3 - write is intercepted with 'MONKEY_READS_TEXT1', read is not intercepted
; 4 - write is not intercepted, read is intercepted with 'MONKEY_READS_TEXT2'
; 5 - write is not intercepted, read is intercepted with 'MONKEY_READS_TEXT1'
[SEMICOLON_TEST]
enabled =TRUE


[SEMICOLON_TEST_PLAN1]
host_match=*.nih.gov
port_match=8080
write1    =return_status=eIO_Closed;    runs=1:100%,2:0%,   3:0%,   repeat;
write2    =return_status=eIO_Interrupt; runs=1:0%,  2:100%, 3:100%, repeat
read1     =return_status=eIO_InvalidArg;runs=1:100%,2:0%,   3:100%, repeat;
read2     =return_status=eIO_Closed;    runs=1:0%,  2:100%, 3:0%,   repeat
connect1  =allow=yes;delay=2000;        runs=1:100%,2:0%,   3:100%, repeat;
connect2  =allow=no; delay=100;         runs=1:0%,  2:100%, 3:0%,   repeat
poll1     =allow=yes;delay=2000;        runs=1:0%,  2:0%,   3:100%, repeat
poll2     =allow=no; delay=100;         runs=1:100%,2:100%, 3:0%,   repeat;


; Plan has all rules ending with semicolon
;[SEMICOLON_TEST_PLAN1]
;host_match=lbos.*
;port_match=8080
;write   = text='MONKEY_WRITES_TEXT1';runs=3;
;read    = text='MONKEY_READS_TEXT1';runs==5
;poll    = ignore=yes;runs==3,repeat;
;connect = allow=no;runs==3,repeat;

; Plan has all rules not ending with semicolon
[SEMICOLON_TEST_PLAN2]
; regexp or wildcard?
host_match=lbos.*
port_match=8080
write   = text='MONKEY_WRITES_TEXT2';runs=2
read    = text='MONKEY_READS_TEXT2';runs=4
poll    = ignore=yes;runs=0%,100%
connect = allow=no;runs=0%,100%

; Test for duplicate parameter - parameter "runs" is set twice in the write rule 
[DUPLPARAM_TEST_WRITE]
enabled =TRUE
[DUPLPARAM_TEST_WRITE_PLAN1]
write   = runs=2;text='MONKEY_WRITES_TEXT1';runs=3;

; Test for duplicate parameter - parameter "runs" is set twice in the read rule 
[DUPLPARAM_TEST_READ]
enabled =TRUE
[DUPLPARAM_TEST_READ_PLAN1]
read    = runs=2;text='MONKEY_READS_TEXT1';runs==5

; Test for duplicate parameter - parameter "allow" is set twice in the connect rule 
[DUPLPARAM_TEST_CONNECT]
enabled =TRUE
[DUPLPARAM_TEST_CONNECT_PLAN1]
connect = allow=no;runs==3,repeat;allow=no;

; Test for duplicate parameter - parameter "ignore" is set twice in the poll rule
[DUPLPARAM_TEST_POLL]
enabled =TRUE
[DUPLPARAM_TEST_POLL_PLAN1]
poll    = ignore=yes;runs==3,repeat;ignore=yes;

; Test for parsing and execution of a valid all-monkey setting for probability. 
; Text in 'write' is not very important, its only task is to replace default text.
; Probability value is 33%
[PROBABILITYVALID1]
enabled =TRUE
probability=33%
[PROBABILITYVALID1_PLAN1]
write   = text='PROBABILITYVALID1_TEXT'

; Test for parsing and execution of a valid all-monkey setting for probability. 
; Text in 'write' is not very important, its only task is to replace default text.
; Probability value is 0%
[PROBABILITYVALID2]
enabled =TRUE
probability=0%
[PROBABILITYVALID2_PLAN1]
write   = text='PROBABILITYVALID2_TEXT'


[PROBABILITYVALID3]
enabled =TRUE
probability=-0%
[PROBABILITYVALID3_PLAN1]
write   = text='PROBABILITYVALID3_TEXT'


[PROBABILITYVALID4]
enabled     = TRUE
probability = 100%
[PROBABILITYVALID4_PLAN1]
write       = text='PROBABILITYVALID4_TEXT'


[PROBABILITYVALID5]
enabled =TRUE
probability=0.0
[PROBABILITYVALID5_PLAN1]
write   = text='PROBABILITYVALID5_TEXT'


[PROBABILITYVALID6]
enabled =TRUE
probability=-0
[PROBABILITYVALID6_PLAN1]
write   = text='PROBABILITYVALID6_TEXT'


[PROBABILITYVALID7]
enabled =TRUE
probability=0.385
[PROBABILITYVALID7_PLAN1]
write   = text='PROBABILITYVALID7_TEXT'


[PROBABILITYVALID8]
enabled =TRUE
probability=1.0
[PROBABILITYVALID8_PLAN1]
write   = text='PROBABILITYVALID8_TEXT'


[PROBABILITYINVALID1]
enabled =TRUE
probability=146%
[PROBABILITYINVALID1_PLAN1]
write   = text='PROBABILITYINVALID1_TEXT'


[PROBABILITYINVALID2]
enabled =TRUE
probability=-10%
[PROBABILITYINVALID2_PLAN1]
write   = text='PROBABILITYINVALID2_TEXT'


[PROBABILITYINVALID3]
enabled =TRUE
probability=1.1
[PROBABILITYINVALID3_PLAN1]
write   = text='PROBABILITYINVALID3_TEXT'


[PROBABILITYINVALID4]
enabled =TRUE
probability=-0.1
[PROBABILITYINVALID4_PLAN1]
write   = text='PROBABILITYINVALID4_TEXT'


[PROBABILITYINVALID5]
enabled =TRUE
probability=-1
[PROBABILITYINVALID5_PLAN1]
write   = text='PROBABILITYINVALID5_TEXT'


[PROBABILITYINVALID6]
enabled =TRUE
probability=0,385
[PROBABILITYINVALID6_PLAN1]
write   = text='PROBABILITYINVALID6_TEXT'


[PROBABILITYINVALID7]
enabled =TRUE
probability=1,0
[PROBABILITYINVALID7_PLAN1]
write   = text='PROBABILITYINVALID7_TEXT'


[PROBABILITYINVALID8]
enabled =TRUE
probability=-0,1
[PROBABILITYINVALID8_PLAN1]
write   = text='PROBABILITYINVALID8_TEXT'


;[CHAOS_MONKEY]
;ENABLED=TRUE
;strength=85%
;[CHAOS_MONKEY_PLAN1]
; regexp or wildcard?
;host_match=lbos.*
;port_match=8080
;write1=return_status=eIO_Unknown;runs=100%
;read1=return_status=eIO_Timeout;runs=100%
; eIO_Interrupt can lead to infinite loop!
;connect1=return_status=eIO_Unknown;runs=100%








; 10% of all connections are intercepted. Of them:
;     33% is simulated to be canceled each 4th time
;     33% is simulated to be timed out each 4th time
;     33% is simulated to be timed out or canceled each 4th time
[CHAOS_MONKEY_LIGHT]
enabled     = 1
probability = 10%

[CHAOS_MONKEY_LIGHT_PLAN1]
probability = 33%
write       = return_status=eIO_Closed;runs=4,repeat
read        = return_status=eIO_Closed;runs=4,repeat
poll        = ignore=yes;runs=4,repeat
connect     = allow=no;  runs=4,repeat

[CHAOS_MONKEY_LIGHT_PLAN2]
probability = 50%
write       = return_status=eIO_Timeout;runs=4,repeat
read        = return_status=eIO_Timeout;runs=4,repeat
poll        = ignore=yes;runs=4,repeat
connect     = allow=no;  runs=4,repeat

[CHAOS_MONKEY_LIGHT_PLAN3]
probability = 100%
write1      = return_status=eIO_Closed; runs=0%,0%,0%,50%,repeat
write2      = return_status=eIO_Timeout;runs=0%,0%,0%,50%,repeat
read1       = return_status=eIO_Closed; runs=0%,0%,0%,50%,repeat
read2       = return_status=eIO_Timeout;runs=0%,0%,0%,50%,repeat
poll        = ignore=yes;runs=4,repeat
connect     = allow=no;  runs=4,repeat


; 25% of all connections are intercepted. Of them:
;     33% is simulated to be canceled each 3rd time
;     33% is simulated to be timed out each 3rd time
;     33% is simulated to be timed out or canceled each 3rd time
[CHAOS_MONKEY_MEDIUM]
enabled     = 1
probability = 25%

[CHAOS_MONKEY_MEDIUM_PLAN1]
probability = 33%
write       = return_status=eIO_Closed;runs=3,repeat
read        = return_status=eIO_Closed;runs=3,repeat
poll        = ignore=yes;runs=3,repeat
connect     = allow=no;  runs=3,repeat

[CHAOS_MONKEY_MEDIUM_PLAN2]
probability = 50%
write       = return_status=eIO_Timeout;runs=3,repeat
read        = return_status=eIO_Timeout;runs=3,repeat
poll        = ignore=yes;runs=3,repeat
connect     = allow=no;  runs=3,repeat

[CHAOS_MONKEY_MEDIUM_PLAN3]
probability = 100%
write1      = return_status=eIO_Closed; runs=0%,0%,50%,repeat
write2      = return_status=eIO_Timeout;runs=0%,0%,50%,repeat
read1       = return_status=eIO_Closed; runs=0%,0%,50%,repeat
read2       = return_status=eIO_Timeout;runs=0%,0%,50%,repeat
poll        = ignore=yes;runs=3,repeat
connect     = allow=no;  runs=3,repeat


; 40% of all connections are intercepted. Of them:
;     33% is simulated to be canceled each 3rd time
;     33% is simulated to be timed out each 3rd time
;     33% is simulated to be timed out or canceled each 3rd time
[CHAOS_MONKEY_HARD]
enabled     = 1
probability = 40%

[CHAOS_MONKEY_HARD_PLAN1]
probability = 33%
write       = return_status=eIO_Closed;runs=3,repeat
read        = return_status=eIO_Closed;runs=3,repeat
poll        = ignore=yes;runs=3,repeat
connect     = allow=no;  runs=3,repeat

[CHAOS_MONKEY_HARD_PLAN2]
probability = 50%
write       = return_status=eIO_Timeout;runs=3,repeat
read        = return_status=eIO_Timeout;runs=3,repeat
poll        = ignore=yes;runs=3,repeat
connect     = allow=no;  runs=3,repeat

[CHAOS_MONKEY_HARD_PLAN3]
probability = 100%
write1      = return_status=eIO_Closed; runs=0%,0%,50%,repeat
write2      = return_status=eIO_Timeout;runs=0%,0%,50%,repeat
read1       = return_status=eIO_Closed; runs=0%,0%,50%,repeat
read2       = return_status=eIO_Timeout;runs=0%,0%,50%,repeat
poll        = ignore=yes;runs=3,repeat
connect     = allow=no;  runs=3,repeat


; 70% of all connections are intercepted. Of them:
;     33% is simulated to be canceled each 2nd time
;     33% is simulated to be timed out each 2nd time
;     33% is simulated to be timed out or canceled each 2nd time
[CHAOS_MONKEY_NIGHTMARE]
enabled     = 1
probability = 70%

[CHAOS_MONKEY_NIGHTMARE_PLAN1]
probability = 33%
write       = return_status=eIO_Closed;runs=2,repeat
read        = return_status=eIO_Closed;runs=2,repeat
poll        = ignore=yes;runs=2,repeat
connect     = allow=no;  runs=2,repeat

[CHAOS_MONKEY_NIGHTMARE_PLAN2]
probability = 50%
write       = return_status=eIO_Timeout;runs=2,repeat
read        = return_status=eIO_Timeout;runs=2,repeat
poll        = ignore=yes;runs=2,repeat
connect     = allow=no;  runs=2,repeat

[CHAOS_MONKEY_NIGHTMARE_PLAN3]
probability = 100%
write1      = return_status=eIO_Closed; runs=0%,0%,50%,repeat
write2      = return_status=eIO_Timeout;runs=0%,0%,50%,repeat
read1       = return_status=eIO_Closed; runs=0%,0%,50%,repeat
read2       = return_status=eIO_Timeout;runs=0%,0%,50%,repeat
poll        = ignore=yes;runs=2,repeat
connect     = allow=no;  runs=2,repeat